<html>

    <!--

    Test page
    ---------------
    
    Intended purpose:

    Testing DOM generating and editing functions. This DOM 
    and functions are intended for testing that functions
    work in their intended purpose by performing content 
    and existence checks which are printed to the console
    
    -->

<head>

    <!-- Bootstrap css theme --> 
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600;800&display=swap" rel="stylesheet">
    
    <!-- Fa icons -->
    <script src="https://kit.fontawesome.com/ff3502b087.js" crossorigin="anonymous"></script>
    
</head>

<body style="font-family: consolas;">

    <style>
        .created_class{border: 0.1pt solid rgb(150, 150, 150); padding: 20px;}
        .blue{font-size: 1.1em;}
    </style>

    <h1>Test page</h1>
    <p id="test_results" style="margin-bottom: 0px; background-color: red;">Testing failure. Check console.</p>
    <p id="test_log" style="color: white; background-color: black;"></p>


    <div class="row">
        
        <div class="col-6">

            <div class="card"  style="margin: 5px; height: 95%; width: 95%;">
                <div class=card-header>
                    <h4>FDG graph</h4>
                </div>
                <div class=card-body>
                    <div><em style="color: rgb(2, 117, 216)">Drawing and editing FDG graph on SVG: </em></div>
                    <svg width="720" height="350" id="test_svg"></svg>
                </div>
            </div>
            
        </div>

        <div class="col-6">
            <div class="row">
            
                <div class="col-6">
                    <div class="card"  style="margin: 5px; height: 95%; width: 95%;">
                        <div class=card-header>
                            <h4>Buttons</h4>
                        </div>
                        <div class=card-body>
                            <em style="color: rgb(2, 117, 216)" >Creating a button here: </em><div id="test_div_btns"></div>
                            <p id="test_messages" style="background-color: lightgrey; margin-top: 0px;"></p>
                        </div>
                    </div>
                </div>
                
                <div class="col-6">
                    <div class="card"  style="margin: 5px; height: 95%; width: 95%;">
                        <div class=card-header>
                            <h4>Progress bars</h4>
                        </div>
                        <div class=card-body>
                            <div id="shadowrealm" style="display: none">
                                <em style="color: rgb(2, 117, 216)" >HIDDEN Progress bar template (static html)</em>
                                <div class="progress" id="progress_bar_template" style="margin: 10px;" >
                                    <div class="progress-bar" role="progressbar" aria-valuenow="70"
                                    aria-valuemin="0" aria-valuemax="100" style="width:70%">
                                    70%
                                    </div>
                                </div>
                            </div>
                            <div id="test_div_progs">
                                <em style="color: rgb(2, 117, 216)" >Initialising a new progress bar (current value 10, bar range 0-10), and editing it (current value 10 --> 5), here: </em>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-6">
                    <div class="card"  style="margin: 5px; height: 95%; width: 95%;">
                        <div class=card-header>
                            <h4>Visibility</h4>
                        </div>
                        <div class=card-body>
                            <em style="color: rgb(2, 117, 216)" >Two boxes are made visible: </em>
                            <div id="test_hidden" style="background-color: rgb(2, 117, 216); color:white; padding: 5px; margin: 5px; border-radius: 2px; visibility: hidden;">visibility: visible</div>
                            <div id="test_none" style="background-color: rgb(2, 117, 216); color:white; padding: 5px; margin: 5px; border-radius: 2px; display: none;">display: block</div>
                        </div>
                    </div>
                </div>
                
                <div class="col-6">
                    <div class="card"  style="margin: 5px; height: 95%; width: 95%;">
                        <div class=card-header>
                            <h4>Text content</h4>
                        </div>
                        <div class=card-body>
                            <em style="color: rgb(2, 117, 216)" >Adding 'test text' here: </em><div id="test_div_text"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-3">
            <div class="card"  style="margin: 5px; height: 95%; width: 95%;">
                <div class=card-header>
                    <h4>Number rounding</h4></div>
                <div class=card-body>
                    <em style="color: rgb(2, 117, 216)" >>10 = 3SF, &lt;10 = 2SF (4DP max)</em><br>
                    <em style="color: " >10.136789325 --> </em><span id="test_div_round" style="background-color: lightgrey"></span><br>
                    <em style="color: rgb(2, 117, 216)" >Numbers can be returned as %</em><br>
                    <em style="color: " >0.0005706 --> </em><span id="test_div_roundPct" style="background-color: lightgrey"></span>
                </div>
            </div>
        </div>

        <div class="col-3">
            <div class="card"  style="margin: 5px; height: 95%; width: 95%;">
                <div class=card-header>
                    <h4>Html content</h4>
                </div>
                <div class=card-body>
                    <em style="color: rgb(2, 117, 216)" >Adding <pre><code>&lt;strong> html code &lt;strong></code></pre> here: </em><div id="test_div_html" style="background-color: lightgrey"></div>
                </div>
            </div>
        </div>

        <div class="col-3">
            <div class="card"  style="margin: 5px; height: 95%; width: 95%;">
                <div class=card-header>
                    <h4>Colors</h4>
                </div>
                <div class=card-body>
                    <em style="color: rgb(2, 117, 216);" >Adding white text on blue background here: </em><div id="test_div_colors" style="padding: 5px; margin: 5px; border-radius: 2px; ">white text on blue bg</div>
                </div>
            </div>
        </div>
    
        <div class="col-3">
            <div class="card"  style="margin: 5px; height: 95%; width: 95%;">
                <div class=card-header>
                    <h4>Divisions</h4>
                </div>
                <div class=card-body id="test_div">
                    <em style="color: rgb(2, 117, 216)" > Adding div here: </em>
                </div>
            </div>
        </div>

        <div class="col-3">
            <div class="card"  style="margin: 5px; height: 95%; width: 95%;">
                <div class=card-header>
                    <h4>Paragraphs</h4>
                </div>
                <div class=card-body style="ghostwhite" id="test_p">
                    <em style="color: rgb(2, 117, 216)" >Adding p here: </em>
                </div>
            </div>
        </div>
        
        <div class="col-3">
            <div class="card"  style="margin: 5px; height: 95%; width: 95%;">
                <div class=card-header>
                    <h4>Font-awesome Icons</h4>
                </div>
                <div class=card-body style="ghostwhite">
                    <em style="color: rgb(2, 117, 216)" >Adding FA icon here: </em>
                    <div id="test_i"></div>
                </div>
            </div>
        </div>

        <div class="col-3">
            <div class="card"  style="margin: 5px; height: 95%; width: 95%;">
                <div class=card-header>
                    <h4>Gamedata</h4>
                </div>
                <div class=card-body style="ghostwhite">
                    <em style="color: rgb(2, 117, 216)" >Getting data summaries: </em>
                    <div id="test_data"></div>
                </div>
            </div>
        </div>

        <div class="col-3">
            <div class="card" style="margin: 5px; height: 95%; width: 95%;">
                <div class=card-header>
                    <h4>Disable button</h4>
                </div>
                <div class=card-body style="ghostwhite">
                    <em style="color: rgb(2, 117, 216)" >Disabling button: </em>
                    <button class="btn btn-primary" id="test_disabled">Button</button>
                    <div id="test_data"></div>
                </div>
            </div>
        </div>

        <div class="col-3">
            <div class="card" style="margin: 5px; height: 95%; width: 95%;">
                <div class=card-header>
                    <h4>Toggle panel</h4>
                </div>
                <div class=card-body style="ghostwhite">
                    <em style="color: rgb(2, 117, 216)" >Hiding white panel with blue border behind blue panel: </em>
                    <div class="row" style="height: 100%; width: 100%;">
                        <div id="test_panel" class="card" style="height: 100%; width: 100; border: 2px solid rgb(2, 117, 216);">
                            <div class="card-header">Panel</div>
                            <div class="card-body">Hide me</div>
                        </div>
                        <div id="test_panel" class="card" style="height: 100%; width: 100; background-color: rgb(2, 117, 216);">
                            <div class="card-header">visible panel</div>
                            <div class="card-body"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="col-3">
            <div class="card" style="margin: 5px; height: 95%; width: 95%;">
                <div class=card-header>
                    <h4>Propagation</h4>
                </div>
                <div class=card-body style="ghostwhite">
                    <em style="color: rgb(2, 117, 216)" >Propagation algorithm: </em>
                    <svg width="300" height="150" id="test_svg2"></svg>
                    <div id="test_data"></div>
                </div>
            </div>
        </div>


    </div>

</body>

<footer>

    <script src="scripts/d3/d3.min.js"></script>
    <script src="scripts/jsnetworkx.js"></script>
    <script src="scripts/edit-element.js"></script>
    <script src="scripts/create-element.js"></script>
    <script src="scripts/event-handling.js"></script>
    <script src="scripts/testing/debug.js"></script>
    <script src="scripts/graph.js"></script>
    <script src="algorithms/propagation.js"></script>
    <script src="data/data_json.js"></script>
    <script src="data/data.js"></script>

    <script>

        // Create button 
        btn='button'
        createButton(btn, 'button text', 'test_div_btns', className = 'btn btn-primary'); //(id of new btn, text of btn, parent to append btn to, classnames (optional))

        // Assign event listener
        function test_function(){
            this.id = 'new_button_id';
           
            // Verify that button was updated with correct event listener object
            document.getElementById("test_messages").innerText = "Passed manual test (event-handling.addOnclickEvent)"
            document.getElementById("test_messages").style.backgroundColor = "lightgreen"
            validate([{name : '[event-handling.] addOnclickEvent (add event)', expected : '[object HTMLButtonElement]', actual : get('new_button_id')},])
        }
        addOnclickEvent(btn, test_function); //(id of element to add listener to, function to activate on-click)

        // Create progress bar
        progId='progress_clone'
        createProgress(progId, 'test_div_progs');  //(id of new progress bar, parent to append btn to)

        // Initialise progress bar
        setProgress(progId, 10, {min:0,max:10});  //(id of progress bar, progress value, progress value range)

        // Set progress bar
        setProgress(progId, 5);

        // Set div text
        setText('test_div_text', 'test text'); //(id of element, text to replace current text content with)
        
        // Round numbers
        setText('test_div_round', roundNum(10.136789325)); //(number to round, option to return it as a percent as a string (optional))
        setText('test_div_roundPct', roundNum(0.0005706, percent=true));

        // Color text
        color('test_div_colors', 'white'); // (id of element, color to set)
        colorBackground('test_div_colors', 'rgb(2, 117, 216)'); // (id of element, color of background to set)
        

        // Set div html
        setHTML('test_div_html', '<strong>test html</strong>'); // (id of element, html to replace current html content with)

        // Set element visibility & display
        setVisibility('test_hidden', 'visible'); // (id of element, visibility ('visible', 'hidden'))
        setDisplay('test_none', 'block'); // (id of element, display ('none' [removed from DOM], 'block' [on DOM], 'inline-block' [on DOM]))

        // Create div and p
        createDiv('created_div', 'test_div', className="created_class") // (id of new element, parent to append new div to, classes (optional))
        createP('created_p', 'text here', 'test_p', className="created_class") // (id of new element, parent to append new p to, classes (optional))
        
        // Return FA icon
        document.getElementById('test_i').innerHTML = faIcon('adjust', 'blue') // (name of FA icon, class (optional))

        // Get gamedata
        objSize = function(obj) {
            var size = 0, key;
            for (key in obj) {
                if (obj.hasOwnProperty(key)) size++;
            }
            return size;
        };
        text = '';
        text += 'n links: ' + objSize(data.links) + '<br>';
        text += 'n nodes: ' + objSize(data.nodes) + '<br>';
        text += 'n game variables: ' + objSize(data.gameVars) + '<br>';
        document.getElementById('test_data').innerHTML = text;

        // Create and edit FDG graph
        console.log(graph.nodesAndEdges)
        drawGraph('#test_svg', graph.nodesAndEdges); // (id of SVG, data for graph)
        outlineNode('ieu_a_1018', 'rgb(20, 20, 20)'); // (id of graph SVG g node element, new outline color)
        updateNode('ukb_b_3957', '0.25', 'updated txt'); // (id of graph SVG g node element, node activation, new label text)
        
        // Disable button
        setDisabled('test_disabled');

        // Toggle open and closed panels
        const panelToHide = new Panel('test_panel', 'right');
            panelToHide.close();
        // Test functions
        tests = validate([

            // Check button was created and has correct text and class information
            {name : '[create-element.] createButton (create element)', expected : '[object HTMLButtonElement]', actual : get(btn)},
            {name : '[create-element.] createButton (set text)', expected : 'button text', actual : get(btn, prop='innerHTML')},
            {name : '[create-element.] createButton (set class)', expected : 'btn btn-primary', actual : get(btn, prop='className')},

            // Check progress bar was created
            {name : '[create-element.] createProgress (create element)', expected : '[object HTMLDivElement]', actual : get(progId)},

            // Check progress bar was updated with correct value, min and max
            {name : '[edit-element.] setProgress (set value)', expected : 5, actual : get(progId, prop='ariaValueNow', child=true)},
            {name : '[edit-element.] setProgress (set min)', expected : 0, actual : get(progId, prop='ariaValueMin', child=true)},
            {name : '[edit-element.] setProgress (set max)', expected : 10, actual : get(progId, prop='ariaValueMax', child=true)},

            // Check text was set correctly
            {name : '[edit-element.] setText (set value)', expected : 'test text', actual : get('test_div_text', prop='textContent')},
            //Check that number was rounded correctly
            {name : '[edit-element.] roundNum (rounding)', expected : '10.1', actual : get('test_div_round', prop='textContent')},
            {name : '[edit-element.] roundNum (percent)', expected : '0.0006%', actual : get('test_div_roundPct', prop='textContent')},

            // Check that color was set
            {name : '[edit-element.] color (color)', expected : 'white', actual : get('test_div_colors', prop=['style','color'])},
            
            // Check that background color was set
            {name : '[edit-element.] colorBackground (bg color)', expected : 'rgb(2, 117, 216)', actual : get('test_div_colors', prop=['style','backgroundColor'])},

            // Check html was set correctly
            {name : '[edit-element.] setHTML (set value)', expected : '<strong>test html</strong>', actual : get('test_div_html', prop='innerHTML')},

            // Check that visibility and display were set correctly
            {name : '[edit-element.] setVisibility (set visibility)', expected : 'visible', actual : get('test_hidden', prop=['style','visibility'])},
            {name : '[edit-element.] setDisplay (set display)', expected : 'block', actual : get('test_none', prop=['style','display'])},

            // Check that div was created correctly
            {name : '[create-element.] createDiv (create element)', expected : '[object HTMLDivElement]', actual : get('created_div')},
            {name : '[create-element.] createDiv (set class)', expected : 'created_class', actual : get('created_div', prop="className")},

            // Check that p was created correctly
            {name : '[create-element.] createP (create element)', expected : '[object HTMLParagraphElement]', actual : get('created_p')},
            {name : '[create-element.] createP (set class)', expected : 'created_class', actual : get('created_p', prop="className")},
            {name : '[create-element.] createP (set text)', expected : 'text here', actual : get('created_p', prop="innerText")},

            // Check that i was created correctly
            {name : '[create-element.] faIcon (return element type)', expected : 'I', actual : get('test_i', prop="tagName", child=true)},
            {name : '[create-element.] faIcon (set class)', expected : 'fas fa-adjust blue', actual : get('test_i', prop="className", child=true)},
        
            // Check that data classes were created successfully
            {name : '[data] data.nodes (nodes exist)', expected : false, actual : (null == data.nodes)},
            {name : '[data] data.edges (edges exist)', expected : false, actual : (null == data.edges)},
            {name : '[data] graph.nodesAndEdges (data format for graphs exist)', expected : false, actual : (null == graph.nodesAndEdges)},
            {name : '[data] graph.colors (color params exist)', expected : false, actual : (null == graph.colors)},
            {name : '[data] prop (prop exists)', expected : false, actual : (null == prop)},
            {name : '[data] game.objective (set objective)', expected : false, actual : (null == game.objective)},
            {name : '[data] game.log (init log)', expected : false, actual : (null == game.log)},

            // Check that FDG was created and edited correctly
            {name : '[graph.] drawGraph (create graph)', expected : 2, actual : objSize(d3.select('#test_svg'))},
            {name : '[graph.] colorEdge (set edge color)', expected : '#d92027', actual : get('e0-line', prop=['getAttr', 'stroke'])},
            {name : '[graph.] outlineNode (set stroke width)', expected : 2, actual : get('ieu_a_1018-circle', prop=['style', 'strokeWidth'])},
            {name : '[graph.] outlineNode (set stroke color)', expected : 'rgb(20, 20, 20)', actual : get('ieu_a_1018-circle', prop=['style', 'stroke'])},
            {name : '[graph.] updateNode (set fill color)', expected : 'rgb(248, 141, 82)', actual : get('ukb_b_3957-circle', prop=['style', 'fill'])},
            {name : '[graph.] updateNode (set text)', expected : 'updated txt', actual : get('ukb_b_3957-text', prop='innerHTML')},
            {name : '[graph.] updateNode (set r)', expected : 7.5, actual : get('ukb_b_3957-circle', prop=['getAttr', 'r'])},

            // Check that disabled works correctly
            {name : '[edit-element.] setDisabled (set disabled)', expected : true, actual : get('test_disabled', prop='disabled')},
        
            // Check that hiding the panel works correctly
            {name : '[edit-element.] class Panel (create class)', expected : 7, actual : objSize(panelToHide)},
            {name : '[edit-element.] class Panel (hide)', expected : '-100px', actual : get('test_panel', prop=['style', 'right'])},
        ])

        if (tests['failed'].length > 0) {
            totalTests = tests['failed'].length + tests['passed'].length
            document.getElementById("test_results").innerText = "Failing automatic tests. " + tests['failed'].length + "/" + totalTests + " tests failed."
            messages="<strong>Log:</strong> <br>"
            for (const failure of tests['failed']){
                messages += failure + '<br>'
            }
            document.getElementById("test_log").innerHTML = messages;
            document.getElementById("test_results").style.backgroundColor = 'lightcoral';
        } else {
            document.getElementById("test_results").innerText = "Passing automatic tests (" + tests['passed'].length + "/" + tests['passed'].length + ")";
            document.getElementById("test_results").style.backgroundColor = 'lightgreen';
            document.getElementById("test_messages").innerText = "Manual test: Click the button to test event-handling.addOnclickEvent."
        }
        
    </script>

</footer>

</html>